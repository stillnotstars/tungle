<!DOCTYPE html>
<html>
<head>

<title>{Title}</title>

<link rel="shortcut icon" href="{Favicon}">
<link rel="alternate" type="application/rss+xml" href="{RSS}">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

{block:Description}
    <meta name="description" content="{MetaDescription}" />
{/block:Description}

<meta name="if:show avatar" content="1" />
<meta name="if:show search" content="1">
<meta name="text:search button text" content="search!">
<meta name="if:show archive" content="1">
<meta name="text:archive link text" content="archive">
<meta name="image:background image" content="">
<meta name="color:background" content="#a084b4">
<meta name="color:text" content="#000" />
<meta name="color:post background" content="#eee" />
<meta name="color:accent" content="#d0a4d4">
<meta name="color:links" content="#4f156a" />
<meta name="select:font" content="serif" />
<meta name="select:font" content="sans-serif" />
<meta name="if:show filter" content="1" />
<meta name="text:filter terms" content="write the tags you use for tagging stuff separated by commas, punctuation unnecessary">

<style type="text/css">

body {
    font-family: {select:font};
    color: {color:text};
    background: {color:background} url({image:background image});
    margin: 0;
    font-size: 16px;
    line-height: 1.3;
}

/* layout */

#themewrapper {
    display: block;
}

.box {
    padding: 1em;
    background: {color:post background};
    border: 5px double {color:accent};
    isolation: isolate;
}

.post, #notes {
    width: min(80vw, 500px);
    margin: 0 auto 70px;
    padding: 1em;
}

.box {
    margin-right: auto;
    margin-left: auto;
}
header {
    position: static;
    width: min(80vw, 500px);
    min-height: 300px;
    max-height: 50vh;
    transform: none;
    margin: 100px 0 70px;
    overflow: scroll;
}
main {
    position: static;
    margin: 100px auto 30px auto;
    width: 100%;
}

@media (min-width: 1200px) {
    #themewrapper {
        display: grid;
        grid-template-columns: 30% 70%;
    }
    header {
        width: 300px;
        position: fixed;
        top: min(20vh, 200px);
        right: calc(60vw + 50px);
        height: max-content;
        max-height: 60vh;
        margin: 0;
    }
    main {
        position: static;
        width: 600px;
        margin: 100px 0 30px calc(40vw + 50px);
    }
}

/* filter */

{block:ifshowfilter}
detail #filter {
    padding-bottom: 0;
}

#filter button {
    font-size: 0.9em;
    margin: auto;
    display: block;
    font-family: {select:font};
}
{/block:ifshowfilter}


label p {
    width: calc(500px - 1em);
}
@media (min-width: 1200px) {
    label p {
        margin: 0;
        width: calc(300px - 1em);
    }
}

.explainbl {
    display: none;
}


/* cosmetic shit */

h1, h2 {
    margin: 0;
}
a {
    color: {color:links};
}
img:not(.lightbox-image) {
    max-width: 100%;
}
hr {
    border: 1px solid {color:accent};
    width: 80%;
}
blockquote {
    border-left: 1px solid {color:accent};
    margin-left: 5px;
    margin-right: 0;
    padding-left: 15px;
}

.avatar:not(.post) {
    width: 24px;
    height: 24px;
    margin-right: 7px;
}

#search {
    display: grid;
    grid-template-columns: 1fr auto;
    font-family: {select:font};
    width: 100%;
}

#search input {
    font-size: 0.9em;
    font-family: {select:font};
    margin: 0.2em;
}

header #icon {
    display: block;
    margin: auto;
    width: max-content;
}
header #icon > img {
    border-radius: 50%;
}

#title {
    font-size: 1.2em;
    line-height: 120%;
    margin-bottom: 10px;
}

nav a {
    text-decoration: none;
}
nav ul {
    padding: 0 1em;
}

.question {
    padding: 5px;
    padding-bottom: 5px;
    margin-bottom: 10px;
    border-bottom: 1px solid {color:accent};
}

#pages {
    margin-bottom: 70px;
}
#pages a {
    display: inline-block;
    padding: 0.5em;
    border: 2px solid {color:accent};
}

#notes ol {
    margin: 0;
    padding-left: 0;
    list-style: none;
}

/* kb only/sr stuff */

.sr-only {
    position: absolute;
    clip: rect(1px, 1px, 1px, 1px);
    overflow: hidden;
}

.sr-only.firstnav {
    top: 50px;
    left: 40%;
}

.focusable:focus {
    clip: auto;
    width: auto;
    height: auto;
    overflow: auto;
    background-color: {color:Post Background};
    z-index: 10000000;
}

</style>
</head>
<body>
<div id="themewrapper">
<header class="box">
{block:ifshowavatar}<a id="icon" href="/"><img src="{PortraitURL-96}" alt="click to go to index" /></a>{/block:ifshowavatar}
{block:ifnotshowavatar}<a style="text-decoration: none;" href="/">{/block:ifnotshowavatar}<h1 id="title">{Title}</h1>{block:ifnotshowavatar}</a>{/block:ifnotshowavatar}
    
<div>{Description}</div>

<nav>
    <ul>
    {block:HasPages}{block:Pages}<li><a href="{URL}">{Label}</a></li>{/block:Pages}{/block:HasPages}
    {block:AskEnabled}<li><a href="/ask">{AskLabel}</a></li>{/block:AskEnabled}
    {block:SubmissionsEnabled}<li><a href="/submit">{SubmitLabel}</a></li>{/block:SubmissionsEnabled}
    {block:ifshowarchive}<li><a href="/archive">{text:archive link text}</a></li>{/block:ifshowarchive}
    </ul>
</nav>

{block:ifshowsearch}
<form id="search" action="/search" method="get">
    <input type="text" name="q" value="{SearchQuery}"/>
    <input type="submit" value="{text:search button text}" />
</form>
{/block:ifshowsearch}

<div style="font-size: 0.8em; margin-top: 1em; margin-bottom: 2em;"><a href="https://github.com/stillnotstars/tungle">Theme Credit</a></div>

{block:ifshowfilter}
<details id="filter"><summary>Filter</summary>
    <a class="sr-only focusable" style="padding: 10px;" href="#main">skip filter</a>
    <div id="blterms">
    </div>
    <button id="filterbutton">filter</button>
</details>
{/block:ifshowfilter}

</header>


<main id="main">

{block:SearchPage}
    {block:nosearchresults}
        <div class="post box">
            <h3>No Posts Found</h3>
        </div>
    {/block:nosearchresults}
{/block:SearchPage}

{block:Posts inlineMediaWidth="500"}
<div class="post box {TagsAsClasses}">
    <div class="explainbl">
        <p>This post has been hidden because it was tagged: <span class="inserttag"></span>. <a href="{Permalink}">Click here to view it</a>.</p>
        {block:HasTags}
        <p>Click here to <a class="showtags" href="#">see the tags</a>.</p>
        <p>tagged: {block:Tags}<a href="{TagURL}">#{Tag}</a> {/block:Tags}</p>
        {/block:HasTags}
    </div>

    <div class="postbody">
    {block:Text}
        <h2><span class="sr-only">Text post: </span>{block:Title}<a href="{Permalink}">{Title}</a>{/block:Title}</h2>
        {block:Reblogs}<div style="margin-bottom: 25px;"><a href="{Permalink}" class="username">{Username}</a>{Body}</div>{/block:Reblogs}
        {block:NotReblog}<div>{Body}</div>{/block:NotReblog}
    {/block:Text}
        
    {block:Photo}
        <h2 class="sr-only">Photo post: </h2>
        {LinkOpenTag}<img src="{PhotoUrl-400}" alt="{PhotoAlt}">{LinkCloseTag}
        {block:Caption}<div>{Caption}</div>{/block:Caption}
    {/block:Photo}
        
    {block:Photoset}
        <h2 class="sr-only">Photoset: </h2>
        {Photoset}
        {block:Caption}<div>{Caption}</div>{/block:Caption}
    {/block:Photoset}
        
    {block:Quote}
        <h2><span class="sr-only">Quote: </span>"{Quote}"</h2>
        {block:Source}<div>{Source}</div>{/block:Source}
    {/block:Quote}
        
    {block:Link}
        <h2><span class="sr-only">Link post: </span><a href="{URL}" {Target}>{Name}</a></h2>
        {block:Description}<div>{Description}</div>{/block:Description}
    {/block:Link}
        
    {block:Chat}
        <h2><span class="sr-only">Chat post: </span>
        {block:Title}<a href="{Permalink}">{Title}</a>{/block:Title}</h2>
        {block:Lines}<div class="{Alt}">{block:Label}<b>{Label}</b>{/block:Label} {Line}</div>{/block:Lines}
    {/block:Chat}
        
    {block:Video}
        <h2 class="sr-only">Video post: </h2>
        {Video-400}
        {block:Caption}<div>{Caption}</div>{/block:Caption}
    {/block:Video}
        
    {block:Audio}
        <h2 class="sr-only">Audio post: </h2>
        <div>{AudioEmbed}</div>
        {block:Caption}<div>{Caption}</div>{/block:Caption}
    {/block:Audio}
        
    {block:Answer}
        <h2 class="sr-only">Ask post:</h2>
        <div class="question"><em>{Asker} asked:</em><br>{Question}</div>
        <div>
        {block:Answerer}
            <div>{Answerer}: </div>
            <div>{Answer}</div>
        {/block:Answerer}
            
        {block:NotReblog}<div style="margin-bottom: 25px;"><a href="{Permalink}" class="username">{name}</a>{Body}</div>
        <div>{Replies}</div>{/block:NotReblog}

        {block:RebloggedFrom}
            {block:Reblogs}
                <div><a href="{permalink}">{username}</a></div>
                <div>{body}</div>
            {/block:Reblogs}
        {/block:RebloggedFrom}
        </div>
    {/block:Answer}
    </div> <!-- for postbody -->

    <div class="postinfo">
        {block:HasTags}<div class="tags">Tagged: {block:Tags}<a href="{TagURL}">#{Tag}</a> {/block:Tags}</div>{/block:HasTags}

        <div style="display: grid; grid-template-columns: 1fr 60px;">
            <div>
                <div>{block:PinnedPostLabel}<i>{PinnedPostLabel}.</i> {/block:PinnedPostLabel}{block:Date}<a href="{Permalink}">{TimeAgo}</a>{/block:Date} {block:NoteCount}/ {NoteCountWithLabel}{/block:NoteCount}</div>
                {block:RebloggedFrom}<div>reblogged from: <a href="{ReblogParentURL}">{ReblogParentName}</a> / source: <a href="{ReblogRootURL}">{ReblogRootName}</a></div>{/block:RebloggedFrom}
            </div>
            <div style="display: flex;">
                <div style="flex: 0 1; margin: 5px;"><span class="sr-only">like button: </span>{LikeButton}</div>
                <div style="flex: 0 1; margin: 5px;"><span class="sr-only">reblog button: </span>{ReblogButton}</div>
            </div>
        </div>
    </div>
</div>
{/block:Posts}

{block:PostNotes}
    <div id="notes" class="box">
        {PostNotes-64}
    </div>
{/block:PostNotes}

{block:IndexPage}
<center id="pages">
    {block:Pagination}{block:PreviousPage}<a href="{PreviousPage}">previous page</a>{/block:PreviousPage}<span style="width: 100px; display: inline-block"></span>
    {block:NextPage}<a href="{NextPage}" class="box">next page</a>{/block:NextPage}
    {/block:Pagination}
</center>
{/block:IndexPage}

</main>
</div>

<script type="text/javascript">
{block:ifshowfilter}
function declass(tag){
    return tag.replace(/\_/g, ' ').replace(/\./g, '');
}

function reclass(tag){
    return tag.replace(/ /g, '_');
}

function forAllClass(classname, fn) {
    let elements = document.getElementsByClassName(classname);
    for (let i = 0; i < elements.length; i++) {
        fn(elements[i]);
    }
}

let blocktags = "{text:filter terms}".split(',').map((str) => str.trim());
let blterms = document.getElementById("blterms");
for (let [i, tag] of blocktags.entries()) {
    blterms.innerHTML += '<label><p><input type="checkbox" id="bl' + i + '"> <span id="labelbl' + i + '">' + tag + '</span></p></label>';
}
let blockclasses = blocktags.map(reclass)

document.getElementById("filterbutton").onclick = () => {
    forAllClass('postbody', (p) => {p.style.display = ""});
    forAllClass('postinfo', (p) => {p.style.display = ""});
    forAllClass('inserttag', (p) => {p.innerHTML = ""});
    forAllClass('tags', (p) => {p.style.display = ""});
    forAllClass('explainbl', (p) => {p.style.display = "none"});

    for (let i = 0; i < blocktags.length; i++) {
        if (document.getElementById("bl" + i).checked) {
            let texttoblock = blockclasses[i];
            forAllClass(texttoblock, (post) => {
                post.querySelector(".inserttag").innerHTML +=  " #" + declass(texttoblock);
                post.querySelector(".postbody").style.display = "none";
                post.querySelector(".tags").style.display = "none";
                post.querySelector(".explainbl").style.display = "block";
            })
        }
    }
}

forAllClass("showtags", (showtags) => {
    showtags.onclick = (e) => {
        e.preventDefault();
        let tagsDisplay = showtags.parentElement.nextElementSibling;
        if (tagsDisplay.style.display == "none") {
            tagsDisplay.style.display = "block"
        } else {
            tagsDisplay.style.display = "none"
        }
    }
});
{/block:ifshowfilter}
let videos = document.getElementsByTagName("video");
for (let i = 0; i < videos.length; i++) {
    videos[i].removeAttribute("autoplay")
}


let imgs = document.getElementsByTagName("img");
for (let i = 0; i < imgs.length; i++) {
    var alt = imgs[i].alt;
    if (alt != "") {
        imgs[i].title = alt;
    }
}
</script>
</body>
